language: node_js
node_js:
- '4'
# - '5'
# - '6'
# - '7'
# - '8'
os:
- linux
- osx
env:
  matrix:
  - CXX=g++-4.8
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.8
matrix:
  fast_finish: true
env:
  global:
    secure: isP6711kxV+in0NMzAMgSGEJgIVg6K2jXaEIEkjW/1hI5Z8szq1A4Zev62idwEJY4UGEI8xpduupB2XALztIbdXObH/FKOFhBLqLOxCpKWuRd595fN9UiRB7UrXRV+WYdFFUwSSvNstr3ZftmDbc6LQnCCLVZA05kexI4tIVwrM=
cache:
  directories:
  - node_modules
  - build
install:
- npm install --ignore-scripts
script:
- npm run build
after_script:
- npm test
before_deploy:
- npm run create_npmrc
deploy:
- provider: script
  skip_cleanup: true
  script: npm publish dist/pact-standalone-darwin --access public
  on:
    branch: master
    tags: true
- provider: script
  skip_cleanup: true
  script: npm publish dist/pact-standalone-linux-ia32 --access public
  on:
    branch: master
    tags: true
- provider: script
  skip_cleanup: true
  script: npm publish dist/pact-standalone-linux-x64 --access public
  on:
    branch: master
    tags: true
- provider: script
  skip_cleanup: true
  script: npm publish dist/pact-standalone-win32 --access public
  on:
    branch: master
    tags: true
- provider: script
  skip_cleanup: true
  script: "npm publish . --access public"
  on:
    branch: master
    tags: true
after_failure:
- find . -iname '*.log' -print0 | xargs -0 cat
